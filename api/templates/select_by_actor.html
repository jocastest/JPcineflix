<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Movies by Joaquim & Pedro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('../images/Cinema1.png');
            background-color: black;
            background-size: 100% auto; 
            background-position: center top; 
            background-repeat: no-repeat; 
        }

        .container_site {
            text-align: center; 
        }

        #sortDropdown {
            font-size: 20px;     
            width: 200px;     
            height: 35px;
        }

        .movie {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
            flex: 0 0 300px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); 
            border-radius: 8px; 
        }

        .movie-info {
            margin-left: 0  ;
        }

        .movie-info p {
            text-align: justify;
        }

        .movie:hover {
            transform: scale(1.03);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .movie-poster img {
            width: 100%; 
            height: 300px;
            border-radius: 4px; 
            display: flex;
            margin-left: auto;
            margin-right: auto;
        }

        #actorMoviesContainer {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; 
            gap: 10px;
        }

        .error-message {
            visibility: hidden;
            min-width: 250px;
            margin: auto;
            background-color: #333;
            color: red;
            font-size: 1.2em;
            margin-top: 20px;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
        }

        .error-show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }


        .movie-title {
            font-size: 18px;
        }

        .movie-release-date {
            font-size: 18px;
        }
        .movie-overview {
            font-size: 18px;
        }

        /* NEW */
        .overview-short {
            display: inline;
        }

        .overview-full {
            display: none;
        }

        .overview-toggle {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-left: 10px;
            cursor: pointer;
        }

        nav {
            background-color: rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000; /* Certifique-se de que a navbar esteja sempre na parte superior */
        }

        ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        li {
            float: right;
        }

        li a {
            display: block;
            color: #fff;
            text-align: center;
            padding: 10px 20px;
            text-decoration: none;
            transition: background-color 0.3s, color 0.3s;
        }

        li a:hover {
            background-color: #ff4500; /* Cor de laranja, você pode escolher outra cor que goste */
            color: #fff;
        }

        .nav-space {
            height: 30px; /* Ajuste a altura conforme necessário para criar espaço suficiente */
        }
        #actorNameInput {
            font-size: 20px;
            width: 200px;
            height: 30px;
        }

        #searchbutton {
            font-size: 20px;
            width: 100px; /* Você pode ajustar a largura do botão conforme necessário */
            height: 35px;
        }

        .image-error-message {
            display: block;
            padding: 10px;
            background-color: red;
            color: white;
            text-align: center;
        }

    </style>

</head>
<body>
    <nav>
        <ul>
            <li><a href="select_by_genre.html">Select by Genre</a></li>
            <li><a href="select_by_actor.html">Select by Actor</a></li>
            <li><a href="../../index.html">Home Page</a></li>
        </ul>
    </nav>
    <div class="nav-space"></div>
    <div class="container_site">

        <input type="text" id="actorNameInput" placeholder="Actor name">
        <button id="searchbutton" onclick="searchActor()">Search</button>

        <select id="sortDropdown">
            <option value="default">Listing Options</option>
            <option value="alphabetical">Alphabetical Order</option>
            <option value="date">Most Recent</option>
            <option value="rated">Top Rated</option>
        </select>

        <div id="actorMoviesContainer"></div>

        <div id="actorpaginationContainer"></div>
    </div>
    <script>

        function toggleOverview(button) {
            var overviewShort = button.previousElementSibling;
            var overviewFull = button.previousElementSibling.previousElementSibling;

            if (overviewFull.style.display === "none") {
                overviewFull.style.display = "inline";
                overviewShort.style.display = "none";
                button.textContent = "Read more";
            } else {
                overviewFull.style.display = "none";
                overviewShort.style.display = "inline";
                button.textContent = "Read less";
            }
        }

        function searchActor() {
            const actorName = document.getElementById('actorNameInput').value;
            document.getElementById('sortDropdown').value ='default';
            if (actorName) {
                fetchActorId(actorName);
            }
        }

        function fetchActorId(actorName) {
            const apiKey = 'e3af560b5c5504c965c876d9a2fe3130';
            const url = `https://api.themoviedb.org/3/search/person?api_key=${apiKey}&query=${encodeURIComponent(actorName)}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.results.length > 0) {
                        const actorId = data.results[0].id;
                        console.log(data)
                        fetchMoviesByActor(actorId);
                    } else {
                        displayError('Nenhum ator encontrado.');
                    }
                })
                .catch(error => {
                    displayError('Erro na busca.');
                });
        }

        function fetchMoviesByActor(actorId) {
            const apiKey ='e3af560b5c5504c965c876d9a2fe3130';
            const url = `https://api.themoviedb.org/3/person/${actorId}/movie_credits?api_key=${apiKey}`;

            fetch(url)

                .then(response => response.json())

                .then(data => {
                    if (data.cast && data.cast.length > 0) {
                        currentMovieData = data.cast;
                        displayMovies(currentMovieData,1);
                    } else {
                        displayError('Nenhum filme encontrado para este ator.');
                    }
                })
                .catch(error => {
                    displayError(error.message);
                });
        }

        function handleImageError(imageElement) {
            // Criar um novo elemento span para a mensagem de erro
            var errorMessage = document.createElement('span');
            errorMessage.textContent = 'Erro ao carregar imagem';
            errorMessage.className = 'image-error-message'; // Classe para estilização CSS

            // Remover a imagem e adicionar a mensagem de erro
            imageElement.parentNode.replaceChild(errorMessage, imageElement);
        }

        function displayMovies(movieData,page) {
            var actorMoviesContainer = document.getElementById('actorMoviesContainer');
            actorMoviesContainer.innerHTML = ''; // Limpa os filmes anteriores

            const start = (page - 1) * moviesPerPage;
            const end = start + moviesPerPage;
            const paginatedMovies = movieData.slice(start, end);

            paginatedMovies.forEach(movie => {
                // contêiner para cada filme
                var movieElement = document.createElement('div');
                movieElement.classList.add('movie');

                // URL do pôster
                const baseUrl = 'https://image.tmdb.org/t/p/';
                const posterSize = 'w200';
                let posterUrl = baseUrl + posterSize + movie.poster_path;

                // Verifica se o overview é mais longo que o limite
                const limit = 150;
                const showMoreButton = movie.overview.length > limit;

                // HTML para o cartaz do filme
                movieElement.innerHTML = `
                    <div class="movie-poster">
                        <img src="${posterUrl}" alt="${movie.title}" onerror="handleImageError(this)">
                    </div>
                    <div class="movie-info">
                        <p class='movie-title'><strong>Title:</strong> ${movie.title}</p>
                        <p class="movie-release-date"><strong>Release date:</strong> ${movie.release_date}</p>
                        <p class="movie-overview">
                            <span class="overview-short"><strong>Synopsis:</strong> ${movie.overview.substring(0, limit)}${showMoreButton ? '...' : ''}</span>
                            ${showMoreButton ? `<span class="overview-full" style="display: none;"><strong>Synopsis:</strong> ${movie.overview}</span>` : ''}
                            ${showMoreButton ? `<button class="overview-toggle" onclick="toggleOverview(this)">Read More</button>` : ''}
                        </p>
                    </div>
                `;
                actorMoviesContainer.appendChild(movieElement);
            });
            
            createPaginationButtons(movieData.length);
        }

        function displayError(errorMessage) {
            var actorpaginationContainer = document.getElementById('actorpaginationContainer');
            actorpaginationContainer.innerHTML = '';

            var actorMoviesContainer = document.getElementById('actorMoviesContainer');
            actorMoviesContainer.innerHTML = `<div class='error-message error-show'>Erro: ${errorMessage} 😞</div>`;
            setTimeout(function () {
                var errorElement = document.querySelector('.error-message');
                errorElement.classList.remove('error-show');
            }, 3000);
        }
    

        let currentPage = 1;
        const moviesPerPage = 3;

        let currentMovieData = []; // Armazenar os dados dos filmes

        function createPaginationButtons(totalMovies) {
            const actorpaginationContainer = document.getElementById('actorpaginationContainer');
            actorpaginationContainer.innerHTML = '';

            const totalPages = Math.ceil(totalMovies / moviesPerPage);
            const maxPageButtons = 5; // Número máximo de botões de página a serem exibidos
            let activePageSet = 1; // Conjunto de páginas ativo

            const updateButtons = () => {
                actorpaginationContainer.innerHTML = '';

                // Botão para navegar para o conjunto anterior de páginas
                if (activePageSet > 1) {
                    const prevSetButton = document.createElement('button');
                    prevSetButton.innerText = '<';
                    prevSetButton.onclick = () => {
                        activePageSet--;
                        updateButtons();
                    };
                    actorpaginationContainer.appendChild(prevSetButton);
                }

                const startPage = (activePageSet - 1) * maxPageButtons + 1;
                const endPage = Math.min(startPage + maxPageButtons - 1, totalPages);

                for (let i = startPage; i <= endPage; i++) {
                    const button = document.createElement('button');
                    button.innerText = i;
                    button.style = 'font-size: 20px; padding: 10px 20px;';
                    button.addEventListener('click', () => {
                        currentPage = i;
                        displayMovies(currentMovieData, i);

                        // Atualizar o conjunto de páginas ativo
                        activePageSet = Math.ceil(i / maxPageButtons);
                        updateButtons();
                    });
                    actorpaginationContainer.appendChild(button);
                }

                // Botão para navegar para o próximo conjunto de páginas
                if (endPage < totalPages) {
                    const nextSetButton = document.createElement('button');
                    nextSetButton.innerText = '>';
                    nextSetButton.onclick = () => {
                        activePageSet++;
                        updateButtons();
                    };
                    actorpaginationContainer.appendChild(nextSetButton);
                }
            };

            updateButtons();
        }

        function sortMovies(sortType) {
            // Funcao para escolha de Listagem (Alfabetica, por data, default 'maneira como vem')
            if (sortType === 'alphabetical') {
                currentMovieData.sort((a, b) => a.title.localeCompare(b.title));
            } else if (sortType === 'date') {
                currentMovieData.sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
            }else if (sortType === 'default') {
                var genreDropdown = document.getElementById("genreDropdown");
                var selectedGenreId = genreDropdown.value;

                if (selectedGenreId === "default") {
                    return;
                }
                fetchMoviesByGenre(selectedGenreId);
                return;
            } else if (sortType === 'rated') {
                currentMovieData.sort((a, b) => b.vote_average - a.vote_average);
            }
            displayMovies(currentMovieData, 1);
        }

        window.onload = function() {
            document.getElementById("sortDropdown").addEventListener('change', function() {
                sortMovies(this.value);
            });
        }
    </script>
</body>
</html>